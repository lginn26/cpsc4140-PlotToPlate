{% extends "base.html" %}
{% block title %}{{ user.username }}'s Profile | FoodShare{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center mb-5">
    <div class="col-md-6 text-center">
      <div class="profile-card p-4">
        <div class="avatar-placeholder mb-3">
          {{ user.username[0] | upper }}
        </div>
        <h3 class="fw-bold">{{ user.username }}</h3>
        <span class="badge badge-custom mb-2">
          üå± {{ user.role or "Garden Volunteer" }}
        </span>
        <p class="text-muted mb-3">
          ‚Äú{{ user.bio or 'Helping our community grow one plant at a time.' }}‚Äù
        </p>

        <div class="d-flex justify-content-center gap-4 flex-wrap">
          <span class="text-success"><i class="bi bi-leaf"></i> {{ user.plant_count or 45 }} plants</span>
          <span class="text-success"><i class="bi bi-geo-alt"></i> {{ user.zone or "Zone 3" }}</span>
          <span class="text-success"><i class="bi bi-people"></i> {{ user.friends or 18 }} friends</span>
        </div>

        <!-- üî• Gardening Streak Section -->
        {% if user.streak %}
        <div class="mt-4 streak-box">
          üî• {{ user.streak }}-Day Gardening Streak!
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-md-4">
      <div class="profile-card p-4 h-100">
        <h5 class="section-title mb-3">üåª Recent Activity</h5>
        {% if activities %}
        <ul class="list-unstyled mb-0">
          {% for act in activities %}
          <li>{{ act }}</li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No recent activity yet.</p>
        {% endif %}
      </div>
    </div>

    <div class="col-md-4">
      <div class="profile-card p-4 h-100">
        <h5 class="section-title mb-3">üçÖ Favorite Plants</h5>
        {% if favorite_plants %}
        <ul class="fav-plant-list list-unstyled">
          {% for plant in favorite_plants %}
          <li><button class="fav-plant-btn">{{ plant }}</button></li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No favorite plants added yet.</p>
        {% endif %}
      </div>
    </div>

    <div class="col-md-4">
      <div class="profile-card p-4 h-100">
        <h5 class="section-title mb-3">ü§ù Community Contributions</h5>
        {% if contributions %}
          {% for c in contributions %}
            <p>{{ c }}</p>
          {% endfor %}
        {% else %}
          <p class="text-muted">No contributions recorded yet.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- My Gardens Section -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="profile-card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="section-title mb-0">My Gardens ({{ gardens|length }})</h5>
          <a href="/garden" class="btn btn-sm btn-success">View All Gardens</a>
        </div>
        
        {% if gardens %}
        <div class="row g-3">
          {% for garden in gardens %}
          <div class="col-md-6 col-lg-4">
            <div class="garden-item">
              <div class="garden-header">
                <h6 class="garden-name">{{ garden.name }}</h6>
                <span class="garden-date">{{ garden.timestamp.strftime('%b %d, %Y') if garden.timestamp else 'Recently' }}</span>
              </div>
              <p class="garden-desc text-muted">{{ garden.description or 'No description provided.' }}</p>
              <div class="garden-meta">
                <span class="badge bg-light text-dark">
                  <i class="fas fa-map-marker-alt"></i> {{ garden.location or 'Location not set' }}
                </span>
                <span class="badge bg-light text-dark">
                  <i class="fas fa-seedling"></i> {{ garden.plants or 'Various plants' }}
                </span>
              </div>
              <div class="garden-grid-info mt-2">
                <small class="text-success">
                  <i class="fas fa-th"></i> {{ garden.rows }}√ó{{ garden.cols }} grid
                </small>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-leaf fa-3x text-muted mb-3"></i>
          <p class="text-muted">You haven't created any gardens yet.</p>
          <a href="/garden" class="btn btn-success">Create Your First Garden</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- My Posts Section -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="profile-card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="section-title mb-0">My Posts ({{ posts|length }})</h5>
          <a href="/community" class="btn btn-sm btn-success">View Community</a>
        </div>
        
        {% if posts %}
        <div class="posts-timeline">
          {% for post in posts %}
          <div class="post-item">
            <div class="post-header">
              <h6 class="post-title">{{ post.title }}</h6>
              <span class="post-date">{{ post.timestamp.strftime('%b %d, %Y at %I:%M %p') if post.timestamp else 'Recently' }}</span>
            </div>
            <p class="post-content">{{ post.content[:150] }}{% if post.content|length > 150 %}...{% endif %}</p>
            <div class="post-meta">
              {% if post.food_type %}
              <span class="badge bg-success">
                <i class="fas fa-tag"></i> {{ post.food_type }}
              </span>
              {% endif %}
              {% if post.quantity %}
              <span class="badge bg-info text-dark">
                <i class="fas fa-weight"></i> {{ post.quantity }}
              </span>
              {% endif %}
              {% if post.location %}
              <span class="badge bg-light text-dark">
                <i class="fas fa-map-marker-alt"></i> {{ post.location }}
              </span>
              {% endif %}
            </div>
            <div class="post-stats mt-2">
              <span class="stat-item">
                <i class="fas fa-heart text-danger"></i> {{ post.likes }} likes
              </span>
              <span class="stat-item">
                <i class="fas fa-reply text-primary"></i> {{ post.replies|length }} replies
              </span>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-comments fa-3x text-muted mb-3"></i>
          <p class="text-muted">You haven't created any posts yet.</p>
          <a href="/community" class="btn btn-success">Share Your First Post</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <footer class="mt-5 text-center text-muted">
    üåø FoodShare ¬© 2025 ‚Äî Growing Together üåª
  </footer>
</div>
{% endblock %}
